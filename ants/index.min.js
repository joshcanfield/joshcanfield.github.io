(self.webpackChunkgenetic_ants=self.webpackChunkgenetic_ants||[]).push([[826],{135:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i=n.p+"7d6e0a05902fc60b8a99d6e5e9d3de5c.png"},678:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i=n.p+"0c974f1eaca2216b40ab5f9381e5e306.png"},137:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i=n.p+"9d949bb562a461fba5a53d696a71a667.jpg"},691:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i=n.p+"524b06f4c34a29235b2aa8fb169ab669.png"},493:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i=n.p+"9940e917384c15884bcd430ee6fc0d67.png"},607:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),n(260);var r=i(n(114)),o={type:Phaser.AUTO,scale:{mode:Phaser.Scale.FIT,parent:"genetic-ants",autoCenter:Phaser.Scale.CENTER_BOTH,width:800,height:600},width:800,height:600,backgroundColor:"#787878",scene:r.default};new Phaser.Game(o)},418:function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=o(n(194)),s=o(n(698)),u=o(n(467)),c=o(n(854)),h=o(n(379)),l=n(976),f=function(t){function e(n,i,r){void 0===n&&(n=e.Activity.STAND),void 0===i&&(i=s.default.RIGHT),void 0===r&&(r=100);var o=t.call(this)||this;return o.id=a.default.nextId(o.constructor.name),o._activity=e.Activity.STAND,o._direction=s.default.LEFT,c.default.construct(o,r),o.activity=n,o.direction=i,o}return r(e,t),e.prototype.getSensors=function(){return[{x:this.x+25*Math.cos(.5-this.headingRadians),y:this.y+25*Math.sin(.5-this.headingRadians)},{x:this.x+25*Math.cos(-.5-this.headingRadians),y:this.y+25*Math.sin(-.5-this.headingRadians)}]},e.prototype.think=function(t){},Object.defineProperty(e.prototype,"activity",{get:function(){return this._activity},set:function(t){this._activity=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction=t},enumerable:!1,configurable:!0}),e}(l.Mixin(u.default,c.default,h.default));!function(t){t.register(c.default.Event.onDeath,(function(e){return e.activity=t.Activity.CRIT_DIE,e.moveable=!1,!0})),t.register(c.default.Event.onRevive,(function(t){return t.moveable=!0,!0})),t.register(u.default.Event.afterMove,(function(t,e){return t.consumeHealth(e/10),!0})),function(t){t.STAND="stand",t.WALK="walk",t.ATTACK="attack",t.BLOCK="block",t.HIT_DIE="hit-die",t.CRIT_DIE="crit-die"}(t.Activity||(t.Activity={}))}(f||(f={})),e.default=f},642:function(t,e,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.hasOwnProperty.call(t,n)&&i(e,t,n);return r(e,t),e},a=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{u(i.next(t))}catch(t){o(t)}}function s(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((i=i.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var c=o(n(765)),h=u(n(486)),l=function(){function t(e){this.disposed=!1,this.memorySize=e,this.inputMemory=[];for(var n=(new t.Input).toArray(),i=0;i<e;++i)this.inputMemory.push(n);this.createModel()}return t.prototype.createModel=function(){var e=this,n=this;c.tidy((function(){var i=[n.memorySize*t.Input.size];e._model=c.sequential(),e._model.add(c.layers.dense({units:8,inputShape:i,useBias:!0,trainable:!1,activation:"sigmoid",kernelInitializer:"randomNormal",biasInitializer:"randomNormal"})),e._model.add(c.layers.dense({units:t.Output.size,batchSize:1,useBias:!0,trainable:!1,activation:"softmax",kernelInitializer:"randomNormal",biasInitializer:"randomNormal"}))}))},t.prototype.think=function(e){return a(this,void 0,void 0,(function(){var n;return s(this,(function(i){return n=this,[2,this.doAsync((function(i,r){c.tidy((function(){if(n.isDisposed())r("disposed");else{n.inputMemory.unshift(e.toArray()),n.inputMemory.pop();var o=[].concat.apply([],n.inputMemory),a=c.tensor2d(o,[1,n.memorySize*t.Input.size]),s=n._model.predict(a,{batchSize:1}),u=Array.from(s.dataSync()),h=new t.Output;h.left=u[0],h.right=u[1],i(h)}}))}))]}))}))},t.prototype.doAsync=function(t){return new Promise((function(e,n){setTimeout(t,0,e,n)}))},t.prototype.breed=function(e){var n=this;console.log("breed:",c.memory());var i=new t(this.memorySize);return c.tidy((function(){for(var t=n._model.getWeights(),r=e._model.getWeights(),o=[],a=0;a<t.length;++a){for(var s=t[a].dataSync().slice(),u=r[a].dataSync().slice(),l=t[a].shape,f=[],d=h.default.random(s.length),p=h.default.random(d,s.length),y=0;y<s.length;++y)f[y]=y>d&&y<p?u[y]:s[y];o[a]=c.tensor(f,l)}i._model.setWeights(o)})),this.logWeights("breed this",this),this.logWeights("breed mate",e),this.logWeights("breed result",i),i},t.prototype.mutate=function(e){var n=this,i=new t(this.memorySize);return c.tidy((function(){for(var r=n._model.getWeights(),o=0,a=[],s=0,u=0;u<r.length;++u){for(var h=r[u].dataSync().slice(),l=[],f=0;f<h.length;++f)Math.random()>e?l[f]=h[f]:(l[f]=h[f]+t.randomAround0(),++s),++o;a[u]=c.tensor(l,r[u].shape)}i._model.setWeights(a),console.debug("Mutation Rate: "+e+"; weights: "+o+"; mutated: "+s),n.logWeights("before mutation ",n),n.logWeights("after mutation",i)})),i},t.randomAround0=function(){return(Math.random()+Math.random()+Math.random()+Math.random()+Math.random()+Math.random()-3)/3},t.prototype.logWeights=function(t,e){},t.prototype.dispose=function(){this.disposed=!0,this._model.dispose()},t.prototype.isDisposed=function(){return this.disposed},Object.defineProperty(t.prototype,"model",{get:function(){return this._model},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return this.mutate(0)},t}();!function(t){c.setBackend("cpu").catch((function(t){console.log(t)}));var e=function(){function t(){this.antennaRight=0,this.antennaLeft=0}return t.prototype.toArray=function(){return[this.antennaLeft,this.antennaRight]},t.size=2,t}();t.Input=e;var n=function(){function t(){}return t.size=2,t}();t.Output=n}(l||(l={})),e.default=l},698:(t,e)=>{"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),e.Direction=void 0,function(t){t[t.LEFT=0]="LEFT",t[t.UP_LEFT=1]="UP_LEFT",t[t.UP=2]="UP",t[t.UP_RIGHT=3]="UP_RIGHT",t[t.RIGHT=4]="RIGHT",t[t.DOWN_RIGHT=5]="DOWN_RIGHT",t[t.DOWN=6]="DOWN",t[t.DOWN_LEFT=7]="DOWN_LEFT"}(n=e.Direction||(e.Direction={})),e.default=n},379:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.on=function(t,e){this._eventHandlers||(this._eventHandlers={}),this._eventHandlers[t]||(this._eventHandlers[t]=[]),this._eventHandlers[t].push(e)},t.prototype.off=function(t,e){var n,i=null===(n=this._eventHandlers)||void 0===n?void 0:n[t];if(i)for(var r=0;r<i.length;r++)i[r]===e&&i.splice(r--,1)},t.register=function(t,e){this._globalEventHandlers[this.name]||(this._globalEventHandlers[this.name]={}),this._globalEventHandlers[this.name][t]||(this._globalEventHandlers[this.name][t]=[]),this._globalEventHandlers[this.name][t].push(e)},t.deregister=function(t,e){var n,i=null===(n=this._globalEventHandlers[this.constructor.name])||void 0===n?void 0:n[t];if(i)for(var r=0;r<i.length;r++)i[r]===e&&i.splice(r--,1)},t.prototype.trigger=function(t){for(var e=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(this._eventHandlers&&this._eventHandlers[t]){var r=this._eventHandlers[t].every((function(t){return!1!==t.apply(e,n)}));if(!r)return r}var o=this.constructor._globalEventHandlers;if(o){var a=this.constructor;do{if(o[a.name]&&o[a.name][t]){var s=o[a.name][t].every((function(t){return!1!==t(e,n)}));if(!s)return!1}a=Object.getPrototypeOf(a)}while(null!==a)}return!0},t._globalEventHandlers={},t}();e.default=n},854:function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(976),s=o(n(379)),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.consumeHealth=function(t){var n=this._health-t;n<=0?(this._health=0,this.trigger(e.Event.onDeath,n)):this._health=n},e.prototype.restoreHealth=function(t){var n=this._health;this._health+=t,this._health>this._maxHealth&&(this._health=this._maxHealth),0===n&&t>0&&this.trigger(e.Event.onRevive,this._health)},e.prototype.isAlive=function(){return this.health>0},e.prototype.isDead=function(){return 0===this.health},Object.defineProperty(e.prototype,"health",{get:function(){return this._health},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxHealth",{get:function(){return this._maxHealth},set:function(t){this._maxHealth=t},enumerable:!1,configurable:!0}),e.construct=function(t,e){t._health=e,t._maxHealth=e},e}(a.Mixin(s.default));!function(t){!function(t){t.onDeath="DEATH",t.onRevive="REVIVE"}(t.Event||(t.Event={}))}(u||(u={})),e.default=u},194:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.nextId=function(e){return void 0===t.idSource[e]?t.idSource[e]=0:++t.idSource[e]},t.idSource={},t}();e.default=n},467:function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=o(n(486)),s=o(n(379)),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._moveable=!0,e._headingRadians=0,e._x=0,e._y=0,e._vx=0,e._vy=0,e._speed=0,e}return r(e,t),e.prototype.move=function(){var t=Math.sqrt(this.vx*this.vx+this.vy*this.vy);this.moveable&&this.trigger(e.Event.beforeMove,t)&&(this.x=this.x+this.vx,this.y=this.y+this.vy,a.default.isFinite(this.x)&&a.default.isFinite(this.y)||console.log("bad x/y"),this.trigger(e.Event.afterMove,t))},e.prototype.setVelocity=function(t,e){this.vx=t,this.vy=e,a.default.isFinite(this.vx)&&a.default.isFinite(this.vy)||console.log("bad x/y")},Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vy",{get:function(){return this._vy},set:function(t){this._vy=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vx",{get:function(){return this._vx},set:function(t){this._vx=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this.moveable&&(this._y=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this.moveable&&(this._x=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"headingRadians",{get:function(){return this._headingRadians},set:function(t){this.moveable&&(this._headingRadians=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"moveable",{get:function(){return this._moveable},set:function(t){this._moveable=t},enumerable:!1,configurable:!0}),e}(n(976).Mixin(s.default));!function(t){!function(t){t.beforeMove="beforeMove",t.afterMove="beforeMove"}(t.Event||(t.Event={}))}(u||(u={})),e.default=u},490:function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{u(i.next(t))}catch(t){o(t)}}function s(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((i=i.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=s(n(418)),c=s(n(642)),h=function(t){function e(e){var n=t.call(this)||this;return n.handleThinkOutput=function(t){var e=n.calculateDirection(t),i=n.speed*(1+(t.left+t.right)/2);for(n.headingRadians+=e,n.headingRadians<0&&(n.headingRadians=2*Math.PI+n.headingRadians);n.headingRadians>2*Math.PI;)n.headingRadians-=2*Math.PI;n.setVelocity(Math.floor(i*Math.cos(n.headingRadians)),-Math.floor(i*Math.sin(n.headingRadians)))},e&&(n.brain=new c.default(5)),n}return r(e,t),e.create=function(){return new e(!0)},e.prototype.think=function(e){return o(this,void 0,void 0,(function(){var n,i,r,o=this;return a(this,(function(a){return t.prototype.think.call(this,e),this.brain=new c.default(5),n=this.getSensors(),i=new c.default.Input,r=e.calcIntensity(n),i.antennaRight=r[0],i.antennaLeft=r[1],[2,new Promise((function(t,e){o.brain.think(i).then(o.handleThinkOutput).then(t).catch(e)}))]}))}))},e.prototype.calculateDirection=function(t){return t.left>t.right?Math.PI/4:-Math.PI/4},e.prototype.mutate=function(t){return this._clone(this.brain.mutate(t))},e.prototype.breedWith=function(t){return this._clone(this.brain.breed(t.brain))},e.prototype.clone=function(){var t=this.brain.clone();return this._clone(t)},e.prototype._clone=function(t){var n=new e(!1);return t&&(n.brain=t),n},e.prototype.dispose=function(){this.brain.dispose()},e}(u.default);e.default=h},548:function(t,e,n){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=i(n(260)).default.Math.Distance,o=function(){function t(){this.food=[]}return t.prototype.calcIntensity=function(t){var e=this;return t.map((function(t){var n=[];return e.food.forEach((function(e){var i=0,o=r.Between(t.x,t.y,e.x,e.y);o<500&&(i=Math.max(0,-Math.pow(o-500,3)/Math.pow(500,2)),n.push(i/500))})),n.length>0?Math.max.apply(Math,n):0}))},t}();e.default=o},114:function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=o(n(260)),s=o(n(829)),u=o(n(826)),c=o(n(137)),h=o(n(691)),l=o(n(548)),f=o(n(490)),d=o(n(486)),p=o(n(634)),y=function(t){function e(){var e=t.call(this,"mutationScene")||this;return e.topScoresLabel=[],e.highScore=Number.MIN_VALUE,e.highScoreGens=[],e.world=new l.default,e}return r(e,t),e.prototype.preload=function(){s.default.preload(this),this.load.image("background",c.default),this.load.image("hole",h.default)},e.prototype.create=function(){this.graphics=this.add.graphics(),this.graphics.setDepth(10),this.graphics.lineStyle(2,16776960,1),this.cameras.main.setBackgroundColor("#207621"),this.add.tileSprite(0,0,1600,1200,"background").setDepth(0),this.add.image(400,300,"hole"),s.default.init(this),this.foodGroup=this.add.group({classType:u.default,runChildUpdate:!0});for(var t=0;t<10;++t){var n=new p.default(this,300,300);this.foodGroup.add(n,!0),this.world.food.push(n.ant),e.placeRandomly(n),n.setDepth(499),n.setActive(!0)}this.antGroup=this.add.group({classType:s.default,runChildUpdate:!0});for(t=0;t<10;++t){var i=new s.default(this,{x:400,y:300,texture:0==t?u.default.Skin.ICE_ANT:u.default.Skin.ANT_LION});this.antGroup.add(i,!0),i.setDepth(500),i.setActive(!0)}this.scoreBoard=this.add.text(10,0,"Progress: 0%",{color:"#0f0"}),this.scoreBoard.setDepth(500);for(t=0;t<5;++t)this.topScoresLabel[t]=this.add.text(100,100,""+(t+1)),this.topScoresLabel[t].setDepth(500)},e.prototype.update=function(t,e){var n=this.antGroup.getChildren(),i=d.default.sortBy(n,["score"]).reverse();this.updateScoreboard(e,i),this.resetFood((function(t){return t.isDead()})),this.updateGeneration(e,n,i)},e.prototype.updateGeneration=function(t,n,i){if(e.currentGenerationTime+=t,!(n.find((function(t){return t.active}))&&e.currentGenerationTime<e.maxGenerationTime)){this.resetFood((function(){return!0})),++e.generationCount,e.currentGenerationTime=0,n.forEach((function(t){return t.setActive(!1)})),i[0].score>this.highScore?(this.highScoreAnt=i[0].ant.clone(),this.highScore=i[0].score,this.highScoreGens.unshift({gen:e.generationCount-1,score:this.highScore}),this.highScoreGens.length>10&&this.highScoreGens.pop()):(console.log("keeping high score brain!"),i.unshift({score:this.highScore,ant:this.highScoreAnt})),console.log(i.map((function(t){return t.score})));var r=i.slice(0,4).map((function(t){return t.ant,t.ant.clone()}));n.forEach((function(t,n){if(t.ant.dispose(),0===n)t.ant=r[0].mutate(0),console.log("high score brain");else if(n<4)t.ant=r[n].mutate(.3),console.log("breeder brain");else if(Math.random()<.1)t.ant=f.default.create(),console.log("random brain");else{var i=d.default.sample(r),o=d.default.sample(r),a=i.breedWith(o);t.ant=a.mutate(.3),a.dispose(),console.log("bred brain")}e.spawnAnt(t)})),r.forEach((function(t){return t.dispose()}))}},e.prototype.resetFood=function(t){this.foodGroup.getChildren().forEach((function(n){t(n.ant)&&(n.ant.restoreHealth(n.ant.maxHealth),e.placeRandomly(n),n.setActive(!0),n.setVisible(!0))}))},e.prototype.updateScoreboard=function(t,n){if(e.scoreboardIntervalTime+=t,!(e.scoreboardIntervalTime<=e.scoreboardUpdateInterval)){this.formatScoreboard(n);for(var i=0;i<this.topScoresLabel.length;++i)this.topScoresLabel[i].x=n[i].x,this.topScoresLabel[i].y=n[i].y}},e.placeRandomly=function(t){t.relocate(d.default.random(0,800),d.default.random(0,600))},e.prototype.formatScoreboard=function(t){function n(t){var e=t.ant.id.toString(),n=t.score,i=t.ant.health;return e.padStart(3," ")+":  "+n.toFixed(2)+" ("+i.toFixed(2)+")"}var i=t.slice(0,5).map(n).join("\n"),r=(e.maxGenerationTime-e.currentGenerationTime)/1e3,o=this.highScoreGens.map((function(t){return t.gen+":"+t.score.toFixed(2)})).join(" | "),a=["Time Remaining: "+r.toFixed(2)+"; Generation: "+e.generationCount,"High Score: "+this.highScore.toFixed(2)+" - "+o,"Top Scores:\n"+i,"Bottom:\n"+n(t[t.length-1])];this.scoreBoard.setText(a)},e.spawnAnt=function(t){t.reset(),t.setActive(!0)},e.maxGenerationTime=6e4,e.currentGenerationTime=0,e.generationCount=1,e.scoreboardUpdateInterval=500,e.scoreboardIntervalTime=0,e}(a.default.Scene);e.default=y},826:function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.AntSprite=void 0,n(260);var a=o(n(135)),s=o(n(678)),u=o(n(493)),c=o(n(418)),h=o(n(698)),l=function(t){function e(n,i,r,o,a){var s=t.call(this,n,i,r,o,a)||this;return s.setDisplayOrigin(64,84),Object.keys(e.Skin).indexOf(o)?s.skin=o:(s.skin=e.Skin.ANT_LION,console.error("Unknown texture "+o+". Default to "+s.skin)),s}return r(e,t),Object.defineProperty(e.prototype,"ant",{get:function(){return this._ant},set:function(t){c.default,this._ant=t},enumerable:!1,configurable:!0}),e.prototype.update=function(e,n){this.x=this.ant.x,this.y=this.ant.y,t.prototype.update.call(this,e,n),this.anims.update(e,n)},e.prototype.setFrameRate=function(t){this.anims.msPerFrame=1e3/t},e.prototype.animate=function(){var n,i,r=e.buildAnimKey(this.skin,this._ant.direction,this._ant.activity);return(null===(i=null===(n=this.anims)||void 0===n?void 0:n.currentAnim)||void 0===i?void 0:i.key)!=r&&t.prototype.play.call(this,r),this},e.prototype.setDirection=function(t){this._ant.direction!=t&&(this._ant.direction=t,this.animate())},e.prototype.getActivity=function(){return this._ant.activity},e.prototype.setActivity=function(t){this._ant.activity!=t&&(this._ant.activity=t,this.animate())},e.preload=function(t){var n={frameWidth:128,frameHeight:128};t.load.spritesheet(e.Skin.ANT_LION,a.default,n),t.load.spritesheet(e.Skin.FIRE_ANT,s.default,n),t.load.spritesheet(e.Skin.ICE_ANT,u.default,n)},e.init=function(t){Object.values(e.Skin).forEach((function(n){var i=n;Object.values(h.default).filter(isFinite).forEach((function(n){var r=n;Object.values(c.default.Activity).forEach((function(n){var o=n,a=e.buildAnimKey(i,r,o);t.anims.create({key:a,frames:t.anims.generateFrameNumbers(i,e.spriteOffset(o,r)),frameRate:6,yoyo:o===c.default.Activity.ATTACK,repeat:o===c.default.Activity.WALK||n===c.default.Activity.STAND?-1:0})}))}))}))},e.buildAnimKey=function(t,e,n){return t+"_"+n+"_"+e},e.spriteOffset=function(t,e){function n(t,e){return{start:t,end:t+e-1}}switch(t){case c.default.Activity.STAND:return n(32*+e,4);case c.default.Activity.WALK:return n(32*+e+4,8);case c.default.Activity.ATTACK:return n(32*+e+12,4);case c.default.Activity.BLOCK:return n(32*+e+16,2);case c.default.Activity.HIT_DIE:return n(32*+e+18,6);case c.default.Activity.CRIT_DIE:return n(32*+e+24,8);default:return n(32*+e,4)}},e.prototype.log=function(t){console.log("id:"+this._ant.id+":",t)},e.prototype.relocate=function(t,e){this.ant.x=t,this.ant.y=e,this.x=t,this.y=e},e}(Phaser.GameObjects.Sprite);e.AntSprite=l,function(t){!function(t){t.ANT_LION="ant-lion",t.FIRE_ANT="fire-ant",t.ICE_ANT="ice-ant"}(t.Skin||(t.Skin={}))}(l=e.AntSprite||(e.AntSprite={})),e.AntSprite=l,e.default=l},634:function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=o(n(826)),s=o(n(418)),u=o(n(698)),c=s.default.Activity,h=function(t){function e(e,n,i){var r=t.call(this,e,n,i,a.default.Skin.FIRE_ANT,0)||this;return r.ant=new s.default(c.CRIT_DIE,u.default.RIGHT,100),r.ant.x=n,r.ant.y=i,r.animate(),r}return r(e,t),e}(a.default);e.default=h},829:function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MutatingAntConfig=void 0;var a=o(n(826)),s=o(n(698)),u=o(n(490)),c=o(n(194)),h=o(n(260)),l=function(t){function e(n,i){var r=t.call(this,n,i.x,i.y,i.texture)||this;return r.id=c.default.nextId(e.constructor.name),r.updateDeltaAccum=0,r.antenna=[],r.score=0,r.lastPoints=0,r.ant=u.default.create(),r.nearestFoodLine=n.add.line(0,0,i.x,i.y,200,200,11796428,.3),r.nearestFoodLine.setDepth(r.depth),r.antenna[0]=n.add.circle(100,100,5,16711680,.3),r.antenna[1]=n.add.circle(100,100,5,65280,.3),r.fadeTween=n.tweens.add({targets:[r,r.antenna[0],r.antenna[1],r.nearestFoodLine],alpha:{from:1,to:0},ease:"Linear",duration:1e3,delay:500,repeat:0,yoyo:!1,onComplete:function(){r.setActive(!1)}}),r.config=i,r.reset(),r.world=n.world,r.animate(),r}return r(e,t),e.prototype.reset=function(){this.fadeTween.restart(),this.fadeTween.pause(),this.score=0,this.lastPoints=0,this.updateDeltaAccum=0,this.thinkingStartMs=0,this.ant.headingRadians=0,this.ant.vx=0,this.ant.vy=0,this.ant.x=this.config.x,this.ant.y=this.config.y,this.ant.speed=5,this.setRotation(this.ant.headingRadians)},e.prototype.preUpdate=function(e,n){var i=this;if(this.animate(),t.prototype.update.call(this,e,n),this.ant.isDead()&&this.fadeTween.paused&&this.fadeTween.play(),this.updateDeltaAccum+=n,!(this.updateDeltaAccum<=100)){if(this.thinkingStartMs)this.ant.move();else{this.thinkingStartMs=window.performance.now();var r=100*this.world.calcIntensity([{x:this.ant.x,y:this.ant.y}])[0];this.score+=r-this.lastPoints,this.lastPoints=r,this.ant.think(this.world).then((function(){i.updateDirection(i.ant.headingRadians),i.ant.move(),i.thinkingStartMs=0})).catch((function(){return i.debug("rejected")})).finally((function(){i.updateDeltaAccum=0}))}this.adjustDebugObjects()}},e.prototype.adjustDebugObjects=function(){var t=this.getNearestFood(this);this.nearestFoodLine.setTo(t.food.x+100,t.food.y+64,this.x+100,this.y+50),t.distance>500?this.nearestFoodLine.setStrokeStyle(5,16711680,.3):this.nearestFoodLine.setStrokeStyle(5,16776960,.3);var e=this.ant.getSensors();this.antenna[0].x=e[0].x,this.antenna[0].y=e[0].y,this.antenna[1].x=e[1].x,this.antenna[1].y=e[1].y},e.prototype.getNearestFood=function(t){for(var e,n=Number.MAX_VALUE,i=0;i<this.world.food.length;++i){var r=this.world.food[i];if(r.isAlive()){var o=h.default.Math.Distance.Between(this.x,this.y,r.x,r.y);if(o<n&&(n=o,e=r),o<30){r.consumeHealth(50),t.ant.restoreHealth(50),t.score+=50,console.log(r.id+"("+r.x+","+r.y+") touched by "+this.id+"("+this.x+","+this.y+")",r.health)}}}return{food:e,distance:n}},e.prototype.getScore=function(){return this.score},e.prototype.updateDirection=function(t){for(var n=e.radiansToDirection[0],i=0;i<e.radiansToDirection.length;++i){var r=e.radiansToDirection[i];if(t>=r.radians-e.PI_OVER_8&&t<=r.radians+e.PI_OVER_8){n=r;break}}var o=n.radians-t;this.setDirection(n.dir),this.setRotation(o)},e.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];1==this.id&&console.log("id: "+this.id,t)},e.PI_OVER_8=Math.PI/8,e.radiansToDirection=[{radians:0,dir:s.default.RIGHT},{radians:Math.PI/4,dir:s.default.UP_RIGHT},{radians:Math.PI/2,dir:s.default.UP},{radians:3*Math.PI/4,dir:s.default.UP_LEFT},{radians:Math.PI,dir:s.default.LEFT},{radians:5*Math.PI/4,dir:s.default.DOWN_LEFT},{radians:3*Math.PI/2,dir:s.default.DOWN},{radians:7*Math.PI/4,dir:s.default.DOWN_RIGHT},{radians:2*Math.PI,dir:s.default.RIGHT}],e}(a.default);e.default=l;var f=function(){};e.MutatingAntConfig=f},906:()=>{},993:()=>{},352:()=>{},589:()=>{},758:()=>{}},0,[[607,666,177,132,711,916,913]]]);